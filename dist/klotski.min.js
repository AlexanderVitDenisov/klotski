/*
 * klotski 0.0.5
 * The JavaScript algorithm for solving klotski game.
 * 
 *
 * Copyright 2017, jeantimex <jean.timex@gmail.com>
 * Released under the MIT license.
*/

!function(){"use strict";function e(){function e(e,r){return(e+2)%u===r}function b(e){var r,o=[];for(r=0;r<v;r++)o[r]=e.board[r].slice(0);var a=[];for(r=0;r<e.heroes.length;r++)a[r]={type:e.heroes[r].type,row:e.heroes[r].row,col:e.heroes[r].col};return{board:o,heroes:a,move:{heroIdx:e.move.heroIdx,dirIdx:e.move.dirIdx},step:e.step,hash:e.hash,hashMirror:e.hashMirror,parent:e.parent}}function k(e){var r,o,a=0,t=e.heroes;for(r=1;r<=l;r++)for(o=1;o<=d;o++){var n=e.board[r][o]-1,u=n>=0&&n<t.length?t[n].type:0;a^=L.key[r-1][o-1].value[u]}return a}function p(e){var r,o,a=0,t=e.heroes;for(r=1;r<=l;r++)for(o=1;o<=d;o++){var n=e.board[r][o]-1,u=n>=0&&n<t.length?t[n].type:0;a^=L.key[r-1][d-o].value[u]}return a}function x(e,n,u,s){var l=s?e.hashMirror:e.hash,h=e.heroes[n],v=h.row,i=h.type,c=s?d-1-h.col:h.col,f=s?-1:1,y=N[s&&u%2==1?(u+2)%4:u],b=y.x,k=y.y;switch(h.type){case r:l^=L.key[v][c].value[i],l^=L.key[v][c].value[0],l^=L.key[v+k][c+b].value[0],l^=L.key[v+k][c+b].value[i];break;case o:l^=L.key[v][c].value[i],l^=L.key[v+1][c].value[i],l^=L.key[v][c].value[0],l^=L.key[v+1][c].value[0],l^=L.key[v+k][c+b].value[0],l^=L.key[v+k+1][c+b].value[0],l^=L.key[v+k][c+b].value[i],l^=L.key[v+k+1][c+b].value[i];break;case a:l^=L.key[v][c].value[i],l^=L.key[v][c+f].value[i],l^=L.key[v][c].value[0],l^=L.key[v][c+f].value[0],l^=L.key[v+k][c+b].value[0],l^=L.key[v+k][c+b+f].value[0],l^=L.key[v+k][c+b].value[i],l^=L.key[v+k][c+b+f].value[i];break;case t:l^=L.key[v][c].value[i],l^=L.key[v][c+f].value[i],l^=L.key[v+1][c].value[i],l^=L.key[v+1][c+f].value[i],l^=L.key[v][c].value[0],l^=L.key[v][c+f].value[0],l^=L.key[v+1][c].value[0],l^=L.key[v+1][c+f].value[0],l^=L.key[v+k][c+y.x].value[0],l^=L.key[v+k][c+y.x+f].value[0],l^=L.key[v+k+1][c+b].value[0],l^=L.key[v+k+1][c+b+f].value[0],l^=L.key[v+k][c+b].value[i],l^=L.key[v+k][c+b+f].value[i],l^=L.key[v+k+1][c+b].value[i],l^=L.key[v+k+1][c+b+f].value[i]}return l}function w(){var e,r;for(L={key:[]},e=0;e<l;e++)for(L.key[e]=[],r=0;r<d;r++)L.key[e][r]={value:[]},m(L.key[e][r])}function m(e){var r;for(r=0;r<s;r++)e.value[r]=I()}function I(){var e=0;do{e=Math.floor(Math.random()*Math.pow(2,31))}while(!e);return parseInt(e)}function M(e,n,u,s){var l=!1;switch(n){case r:l=e.board[u+1][s+1]===f;break;case o:l=e.board[u+1][s+1]===f&&e.board[u+2][s+1]===f;break;case a:l=e.board[u+1][s+1]===f&&e.board[u+1][s+2]===f;break;case t:l=e.board[u+1][s+1]===f&&e.board[u+1][s+2]===f&&e.board[u+2][s+1]===f&&e.board[u+2][s+2]===f;break;default:l=!1}return l}function z(e,n,u){var s,l,d,h,v=!1,i=e.heroes[n],c=N[u];switch(i.type){case r:v=e.board[i.row+c.y+1][i.col+c.x+1]==f;break;case o:s=e.board[i.row+c.y+1][i.col+c.x+1],l=e.board[i.row+c.y+2][i.col+c.x+1],v=!(s!=f&&s!=n+1||l!=f&&l!=n+1);break;case a:s=e.board[i.row+c.y+1][i.col+c.x+1],l=e.board[i.row+c.y+1][i.col+c.x+2],v=!(s!=f&&s!=n+1||l!=f&&l!=n+1);break;case t:s=e.board[i.row+c.y+1][i.col+c.x+1],l=e.board[i.row+c.y+2][i.col+c.x+1],d=e.board[i.row+c.y+1][i.col+c.x+2],h=e.board[i.row+c.y+2][i.col+c.x+2],v=!(s!=f&&s!=n+1||l!=f&&l!=n+1||d!=f&&d!=n+1||h!=f&&h!=n+1);break;default:v=!1}return v}function g(e,n,u,s){switch(n){case r:e.board[u+1][s+1]=f;break;case o:e.board[u+1][s+1]=f,e.board[u+2][s+1]=f;break;case a:e.board[u+1][s+1]=f,e.board[u+1][s+2]=f;break;case t:e.board[u+1][s+1]=f,e.board[u+1][s+2]=f,e.board[u+2][s+1]=f,e.board[u+2][s+2]=f}}function K(e,n,u,s,l){switch(u){case r:e.board[s+1][l+1]=n+1;break;case o:e.board[s+1][l+1]=n+1,e.board[s+2][l+1]=n+1;break;case a:e.board[s+1][l+1]=n+1,e.board[s+1][l+2]=n+1;break;case t:e.board[s+1][l+1]=n+1,e.board[s+1][l+2]=n+1,e.board[s+2][l+1]=n+1,e.board[s+2][l+2]=n+1}}function S(e,r,o){return!!M(e,o.type,o.row,o.col)&&(K(e,r,o.type,o.row,o.col),e.heroes.push(o),!0)}function j(e){var r,o;for(r=0;r<v;r++)for(e.board[r]=[],o=0;o<h;o++)e.board[r][o]=f;for(r=0;r<h;r++)e.board[0][r]=y,e.board[v-1][r]=y;for(r=1;r<v-1;r++)e.board[r][0]=y,e.board[r][h-1]=y}function q(e){var r={caoIdx:0,states:[],zhash:{},result:{time:null,moves:[]}},o={board:[],heroes:[],move:{heroIdx:0,dirIdx:0},step:0,hash:0,hashMirror:0,parent:null};w(),j(o),o.parent=null,o.step=0,o.move.heroIdx=0,o.move.dirIdx=0;for(var a=0;a<e.length;a++){var t={type:e[a].type,row:e[a].position[0],col:e[a].position[1]};if(4===e[a].type&&(r.caoIdx=a),!S(o,a,t))return null}return o.hash=k(o),o.hashMirror=p(o),r.states.push(o),r}function A(e,r){var o=r.hash;if(e.zhash[o]=!0,n){var a=r.hashMirror;e.zhash[a]=!0}}function B(e,r){for(var o=r;o;){if(o.step>0){var a={step:o.step,heroIdx:o.move.heroIdx,dirIdx:o.move.dirIdx};e.result.moves.push(a)}o=o.parent}}function C(e,r){var o=r.heroes[e.caoIdx];return o.row===i&&o.col===c}function D(e){for(var r=0;r<e.states.length;){var o=e.states[r++];if(A(e,o),C(e,o))return B(e,o),!0;E(e,o)}return!1}function E(e,r){for(var o=0;o<r.heroes.length;o++)for(var a=0;a<u;a++)F(e,r,o,a)}function F(e,r,o,a){var t=G(e,r,o,a);t&&H(e,t)&&J(e,t,o,a)}function G(e,r,o,a){if(z(r,o,a)){var t=x(r,o,a);if(e.zhash[t])return null;var u=0;if(n&&(u=x(r,o,a,!0),e.zhash[u]))return null;var s=b(r),l=s.heroes[o],d=N[a];return g(s,l.type,l.row,l.col),K(s,o,l.type,l.row+d.y,l.col+d.x),l.row=l.row+d.y,l.col=l.col+d.x,s.heroes[o]=l,s.step=r.step+1,s.parent=r,s.move.heroIdx=o,s.move.dirIdx=a,s.hash=t,n&&(s.hashMirror=u),s}return null}function H(e,r){var o=r.hash,a=0;return!e.zhash[o]&&((!n||(a=r.hashMirror,!e.zhash[a]))&&(e.zhash[o]=!0,n&&(e.zhash[a]=!0),e.states.push(r),!0))}function J(r,o,a,t){for(var n=0;n<u;n++)if(!e(n,t)){var s=G(r,o,a,n);s&&H(r,s)&&s.step--}}var L,N=[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}];this.solve=function(e,r){var o=q(e);return o&&D(o)?o.result.moves:null}}var r=1,o=2,a=3,t=4,n=!0,u=4,s=5,l=5,d=4,h=6,v=7,i=3,c=1,f=0,y=-1;"undefined"!=typeof define&&null!==define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&null!==module&&"undefined"!=typeof exports&&module.exports===exports?module.exports=e:"undefined"!=typeof self&&"function"==typeof self.postMessage&&"function"==typeof self.importScripts?self.Klotski=e:"undefined"!=typeof window&&null!==window&&(window.Klotski=e)}();