/*
 * klotski 1.0.1
 * The JavaScript algorithm for solving klotski game.
 * 
 *
 * Copyright 2017, jeantimex <jean.timex@gmail.com>
 * Released under the MIT license.
*/

!function(){"use strict";function e(){function e(e,r){return(e+2)%n===r}function y(e){var r,o=[];for(r=0;r<v;r++)o[r]=e.board[r].slice(0);var a=[];for(r=0;r<e.blocks.length;r++)a[r]={type:e.blocks[r].type,row:e.blocks[r].row,col:e.blocks[r].col};return{board:o,blocks:a,move:{blockIdx:e.move.blockIdx,dirIdx:e.move.dirIdx},step:e.step,hash:e.hash,hashMirror:e.hashMirror,parent:e.parent}}function h(e){var r,o,a=0,t=e.blocks;for(r=1;r<=s;r++)for(o=1;o<=c;o++){var l=e.board[r][o]-1,n=l>=0&&l<t.length?t[l].type:0;a^=L.key[r-1][o-1].value[n]}return a}function p(e){var r,o,a=0,t=e.blocks;for(r=1;r<=s;r++)for(o=1;o<=c;o++){var l=e.board[r][o]-1,n=l>=0&&l<t.length?t[l].type:0;a^=L.key[r-1][c-o].value[n]}return a}function x(e,l,n,u){var s=u?e.hashMirror:e.hash,d=e.blocks[l],v=d.row,b=d.type,f=u?c-1-d.col:d.col,i=u?-1:1,k=N[u&&n%2==1?(n+2)%4:n],y=k.x,h=k.y;switch(d.type){case r:s^=L.key[v][f].value[b],s^=L.key[v][f].value[0],s^=L.key[v+h][f+y].value[0],s^=L.key[v+h][f+y].value[b];break;case o:s^=L.key[v][f].value[b],s^=L.key[v+1][f].value[b],s^=L.key[v][f].value[0],s^=L.key[v+1][f].value[0],s^=L.key[v+h][f+y].value[0],s^=L.key[v+h+1][f+y].value[0],s^=L.key[v+h][f+y].value[b],s^=L.key[v+h+1][f+y].value[b];break;case a:s^=L.key[v][f].value[b],s^=L.key[v][f+i].value[b],s^=L.key[v][f].value[0],s^=L.key[v][f+i].value[0],s^=L.key[v+h][f+y].value[0],s^=L.key[v+h][f+y+i].value[0],s^=L.key[v+h][f+y].value[b],s^=L.key[v+h][f+y+i].value[b];break;case t:s^=L.key[v][f].value[b],s^=L.key[v][f+i].value[b],s^=L.key[v+1][f].value[b],s^=L.key[v+1][f+i].value[b],s^=L.key[v][f].value[0],s^=L.key[v][f+i].value[0],s^=L.key[v+1][f].value[0],s^=L.key[v+1][f+i].value[0],s^=L.key[v+h][f+k.x].value[0],s^=L.key[v+h][f+k.x+i].value[0],s^=L.key[v+h+1][f+y].value[0],s^=L.key[v+h+1][f+y+i].value[0],s^=L.key[v+h][f+y].value[b],s^=L.key[v+h][f+y+i].value[b],s^=L.key[v+h+1][f+y].value[b],s^=L.key[v+h+1][f+y+i].value[b]}return s}function w(){var e,r;for(L={key:[]},e=0;e<s;e++)for(L.key[e]=[],r=0;r<c;r++)L.key[e][r]={value:[]},m(L.key[e][r])}function m(e){var r;for(r=0;r<u;r++)e.value[r]=I()}function I(){var e=0;do{e=Math.floor(Math.random()*Math.pow(2,31))}while(!e);return parseInt(e)}function M(e,l,n,u){var s=!1;switch(l){case r:s=e.board[n+1][u+1]===i;break;case o:s=e.board[n+1][u+1]===i&&e.board[n+2][u+1]===i;break;case a:s=e.board[n+1][u+1]===i&&e.board[n+1][u+2]===i;break;case t:s=e.board[n+1][u+1]===i&&e.board[n+1][u+2]===i&&e.board[n+2][u+1]===i&&e.board[n+2][u+2]===i;break;default:s=!1}return s}function g(e,l,n){var u,s,c,d,v=!1,b=e.blocks[l],f=N[n];switch(b.type){case r:v=e.board[b.row+f.y+1][b.col+f.x+1]==i;break;case o:u=e.board[b.row+f.y+1][b.col+f.x+1],s=e.board[b.row+f.y+2][b.col+f.x+1],v=!(u!=i&&u!=l+1||s!=i&&s!=l+1);break;case a:u=e.board[b.row+f.y+1][b.col+f.x+1],s=e.board[b.row+f.y+1][b.col+f.x+2],v=!(u!=i&&u!=l+1||s!=i&&s!=l+1);break;case t:u=e.board[b.row+f.y+1][b.col+f.x+1],s=e.board[b.row+f.y+2][b.col+f.x+1],c=e.board[b.row+f.y+1][b.col+f.x+2],d=e.board[b.row+f.y+2][b.col+f.x+2],v=!(u!=i&&u!=l+1||s!=i&&s!=l+1||c!=i&&c!=l+1||d!=i&&d!=l+1);break;default:v=!1}return v}function z(e,l,n,u){switch(l){case r:e.board[n+1][u+1]=i;break;case o:e.board[n+1][u+1]=i,e.board[n+2][u+1]=i;break;case a:e.board[n+1][u+1]=i,e.board[n+1][u+2]=i;break;case t:e.board[n+1][u+1]=i,e.board[n+1][u+2]=i,e.board[n+2][u+1]=i,e.board[n+2][u+2]=i}}function K(e,l,n,u,s){switch(n){case r:e.board[u+1][s+1]=l+1;break;case o:e.board[u+1][s+1]=l+1,e.board[u+2][s+1]=l+1;break;case a:e.board[u+1][s+1]=l+1,e.board[u+1][s+2]=l+1;break;case t:e.board[u+1][s+1]=l+1,e.board[u+1][s+2]=l+1,e.board[u+2][s+1]=l+1,e.board[u+2][s+2]=l+1}}function j(e,r,o){return!!M(e,o.type,o.row,o.col)&&(K(e,r,o.type,o.row,o.col),e.blocks.push(o),!0)}function S(e){var r,o;for(r=0;r<v;r++)for(e.board[r]=[],o=0;o<d;o++)e.board[r][o]=i;for(r=0;r<d;r++)e.board[0][r]=k,e.board[v-1][r]=k;for(r=1;r<v-1;r++)e.board[r][0]=k,e.board[r][d-1]=k}function q(e){var r={caoIdx:0,states:[],zhash:{},result:{time:null,moves:[]}},o={board:[],blocks:[],move:{blockIdx:0,dirIdx:0},step:0,hash:0,hashMirror:0,parent:null};if(w(),S(o),o.parent=null,o.step=0,o.move.blockIdx=0,o.move.dirIdx=0,!e||0===e.length)return null;if("object"==typeof e[0])for(a=0;a<e.length;a++){t={type:e[a].type,row:e[a].position[0],col:e[a].position[1]};if(4===e[a].type&&(r.caoIdx=a),!j(o,a,t))return null}else{if("number"!=typeof e[0])return null;for(var a=0;a<e.length;a+=3){var t={type:e[a],row:e[a+1],col:e[a+2]};if(4===e[a]&&(r.caoIdx=a/3),!j(o,a/3,t))return null}}return o.hash=h(o),o.hashMirror=p(o),r.states.push(o),r}function A(e,r){var o=r.hash;if(e.zhash[o]=!0,l){var a=r.hashMirror;e.zhash[a]=!0}}function B(e,r){for(var o=r;o;){if(o.step>0){var a={step:o.step,blockIdx:o.move.blockIdx,dirIdx:o.move.dirIdx};e.result.moves.push(a)}o=o.parent}}function C(e,r){var o=r.blocks[e.caoIdx];return o.row===b&&o.col===f}function D(e){for(var r=0;r<e.states.length;){var o=e.states[r++];if(A(e,o),C(e,o))return B(e,o),!0;E(e,o)}return!1}function E(e,r){for(var o=0;o<r.blocks.length;o++)for(var a=0;a<n;a++)F(e,r,o,a)}function F(e,r,o,a){var t=G(e,r,o,a);t&&H(e,t)&&J(e,t,o,a)}function G(e,r,o,a){if(g(r,o,a)){var t=x(r,o,a);if(e.zhash[t])return null;var n=0;if(l&&(n=x(r,o,a,!0),e.zhash[n]))return null;var u=y(r),s=u.blocks[o],c=N[a];return z(u,s.type,s.row,s.col),K(u,o,s.type,s.row+c.y,s.col+c.x),s.row=s.row+c.y,s.col=s.col+c.x,u.blocks[o]=s,u.step=r.step+1,u.parent=r,u.move.blockIdx=o,u.move.dirIdx=a,u.hash=t,l&&(u.hashMirror=n),u}return null}function H(e,r){var o=r.hash,a=0;return!e.zhash[o]&&((!l||(a=r.hashMirror,!e.zhash[a]))&&(e.zhash[o]=!0,l&&(e.zhash[a]=!0),e.states.push(r),!0))}function J(r,o,a,t){for(var l=0;l<n;l++)if(!e(l,t)){var u=G(r,o,a,l);u&&H(r,u)&&u.step--}}var L,N=[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}];this.solve=function(e,r){var o=q(e);return o&&D(o)?o.result.moves:null}}var r=1,o=2,a=3,t=4,l=!0,n=4,u=5,s=5,c=4,d=6,v=7,b=3,f=1,i=0,k=-1;"undefined"!=typeof define&&null!==define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&null!==module&&"undefined"!=typeof exports&&module.exports===exports?module.exports=e:"undefined"!=typeof self&&"function"==typeof self.postMessage&&"function"==typeof self.importScripts?self.Klotski=e:"undefined"!=typeof window&&null!==window&&(window.Klotski=e)}();