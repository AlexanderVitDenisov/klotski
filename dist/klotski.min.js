/*
 * klotski 1.1.0
 * The JavaScript algorithm for solving klotski game.
 * 
 *
 * Copyright 2017, jeantimex <jean.timex@gmail.com>
 * Released under the MIT license.
*/

!function(){"use strict";var k=!0;function e(){var i,f=[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}];function c(e,r,o,a){var l=a?e.hashMirror:e.hash,t=e.blocks[r],n=t.row,u=t.type,s=a?3-t.col:t.col,c=a?-1:1,d=f[a&&o%2==1?(o+2)%4:o],b=d.x,v=d.y;switch(t.type){case 1:l^=i.key[n][s].value[u],l^=i.key[n][s].value[0],l^=i.key[n+v][s+b].value[0],l^=i.key[n+v][s+b].value[u];break;case 2:l^=i.key[n][s].value[u],l^=i.key[n+1][s].value[u],l^=i.key[n][s].value[0],l^=i.key[n+1][s].value[0],l^=i.key[n+v][s+b].value[0],l^=i.key[n+v+1][s+b].value[0],l^=i.key[n+v][s+b].value[u],l^=i.key[n+v+1][s+b].value[u];break;case 3:l^=i.key[n][s].value[u],l^=i.key[n][s+c].value[u],l^=i.key[n][s].value[0],l^=i.key[n][s+c].value[0],l^=i.key[n+v][s+b].value[0],l^=i.key[n+v][s+b+c].value[0],l^=i.key[n+v][s+b].value[u],l^=i.key[n+v][s+b+c].value[u];break;case 4:l^=i.key[n][s].value[u],l^=i.key[n][s+c].value[u],l^=i.key[n+1][s].value[u],l^=i.key[n+1][s+c].value[u],l^=i.key[n][s].value[0],l^=i.key[n][s+c].value[0],l^=i.key[n+1][s].value[0],l^=i.key[n+1][s+c].value[0],l^=i.key[n+v][s+d.x].value[0],l^=i.key[n+v][s+d.x+c].value[0],l^=i.key[n+v+1][s+b].value[0],l^=i.key[n+v+1][s+b+c].value[0],l^=i.key[n+v][s+b].value[u],l^=i.key[n+v][s+b+c].value[u],l^=i.key[n+v+1][s+b].value[u],l^=i.key[n+v+1][s+b+c].value[u]}return l}function t(e){var r;for(r=0;r<5;r++)e.value[r]=o()}function o(){for(var e=0;!(e=Math.floor(Math.random()*Math.pow(2,31))););return parseInt(e)}function d(e,r,o,a,l){switch(o){case 1:e.board[a+1][l+1]=r+1;break;case 2:e.board[a+1][l+1]=r+1,e.board[a+2][l+1]=r+1;break;case 3:e.board[a+1][l+1]=r+1,e.board[a+1][l+2]=r+1;break;case 4:e.board[a+1][l+1]=r+1,e.board[a+1][l+2]=r+1,e.board[a+2][l+1]=r+1,e.board[a+2][l+2]=r+1}}function n(e,r,o){return!!function(e,r,o,a){var l=!1;switch(r){case 1:l=0===e.board[o+1][a+1];break;case 2:l=0===e.board[o+1][a+1]&&0===e.board[o+2][a+1];break;case 3:l=0===e.board[o+1][a+1]&&0===e.board[o+1][a+2];break;case 4:l=0===e.board[o+1][a+1]&&0===e.board[o+1][a+2]&&0===e.board[o+2][a+1]&&0===e.board[o+2][a+2];break;default:l=!1}return l}(e,o.type,o.row,o.col)&&(d(e,r,o.type,o.row,o.col),e.blocks.push(o),!0)}function a(e){var r={caoIdx:0,states:[],zhash:{},result:{time:null,moves:[]}},o={board:[],blocks:[],move:{blockIdx:0,dirIdx:0},step:0,hash:0,hashMirror:0,parent:null};if(function(){var e,r;for(i={key:[]},e=0;e<5;e++)for(i.key[e]=[],r=0;r<4;r++)i.key[e][r]={value:[]},t(i.key[e][r])}(),function(e){var r,o;for(r=0;r<7;r++)for(e.board[r]=[],o=0;o<6;o++)e.board[r][o]=0;for(r=0;r<6;r++)e.board[0][r]=-1,e.board[6][r]=-1;for(r=1;r<6;r++)e.board[r][0]=-1,e.board[r][5]=-1}(o),o.parent=null,o.step=0,o.move.blockIdx=0,o.move.dirIdx=0,!e||0===e.length)return null;if("object"==typeof e[0])for(var a=0;a<e.length;a++){var l={type:e[a].type,row:e[a].position[0],col:e[a].position[1]};if(4===e[a].type&&(r.caoIdx=a),!n(o,a,l))return null}else{if("number"!=typeof e[0])return null;for(a=0;a<e.length;a+=3){l={type:e[a],row:e[a+1],col:e[a+2]};if(4===e[a]&&(r.caoIdx=a/3),!n(o,a/3,l))return null}}return o.hash=function(e){var r,o,a=0,l=e.blocks;for(r=1;r<=5;r++)for(o=1;o<=4;o++){var t=e.board[r][o]-1,n=0<=t&&t<l.length?l[t].type:0;a^=i.key[r-1][o-1].value[n]}return a}(o),o.hashMirror=function(e){var r,o,a=0,l=e.blocks;for(r=1;r<=5;r++)for(o=1;o<=4;o++){var t=e.board[r][o]-1,n=0<=t&&t<l.length?l[t].type:0;a^=i.key[r-1][4-o].value[n]}return a}(o),r.states.push(o),r}function u(e,r){var o=r.hash;if(e.zhash[o]=!0,k){var a=r.hashMirror;e.zhash[a]=!0}}function s(e,r){for(var o=r;o;){if(0<o.step){var a={step:o.step,blockIdx:o.move.blockIdx,dirIdx:o.move.dirIdx};e.result.moves.push(a)}o=o.parent}}function b(e,r){for(var o=0;o<r.blocks.length;o++)for(var a=0;a<4;a++)l(e,r,o,a)}function l(e,r,o,a){var l=v(e,r,o,a);l&&y(e,l)&&function(e,r,o,a){for(var l=0;l<4;l++)if((l+2)%4!==a){var t=v(e,r,o,l);t&&y(e,t)&&t.step--}}(e,l,o,a)}function v(e,r,o,a){if(function(e,r,o){var a,l,t,n,u=!1,s=e.blocks[r],c=f[o];switch(s.type){case 1:u=0==e.board[s.row+c.y+1][s.col+c.x+1];break;case 2:a=e.board[s.row+c.y+1][s.col+c.x+1],l=e.board[s.row+c.y+2][s.col+c.x+1],u=!(0!=a&&a!=r+1||0!=l&&l!=r+1);break;case 3:a=e.board[s.row+c.y+1][s.col+c.x+1],l=e.board[s.row+c.y+1][s.col+c.x+2],u=!(0!=a&&a!=r+1||0!=l&&l!=r+1);break;case 4:a=e.board[s.row+c.y+1][s.col+c.x+1],l=e.board[s.row+c.y+2][s.col+c.x+1],t=e.board[s.row+c.y+1][s.col+c.x+2],n=e.board[s.row+c.y+2][s.col+c.x+2],u=!(0!=a&&a!=r+1||0!=l&&l!=r+1||0!=t&&t!=r+1||0!=n&&n!=r+1);break;default:u=!1}return u}(r,o,a)){var l=c(r,o,a);if(e.zhash[l])return null;var t=0;if(k&&(t=c(r,o,a,!0),e.zhash[t]))return null;var n=function(e){var r,o=[];for(r=0;r<7;r++)o[r]=e.board[r].slice(0);var a=[];for(r=0;r<e.blocks.length;r++)a[r]={type:e.blocks[r].type,row:e.blocks[r].row,col:e.blocks[r].col};return{board:o,blocks:a,move:{blockIdx:e.move.blockIdx,dirIdx:e.move.dirIdx},step:e.step,hash:e.hash,hashMirror:e.hashMirror,parent:e.parent}}(r),u=n.blocks[o],s=f[a];return function(e,r,o,a){switch(r){case 1:e.board[o+1][a+1]=0;break;case 2:e.board[o+1][a+1]=0,e.board[o+2][a+1]=0;break;case 3:e.board[o+1][a+1]=0,e.board[o+1][a+2]=0;break;case 4:e.board[o+1][a+1]=0,e.board[o+1][a+2]=0,e.board[o+2][a+1]=0,e.board[o+2][a+2]=0}}(n,u.type,u.row,u.col),d(n,o,u.type,u.row+s.y,u.col+s.x),u.row=u.row+s.y,u.col=u.col+s.x,n.blocks[o]=u,n.step=r.step+1,n.parent=r,n.move.blockIdx=o,n.move.dirIdx=a,n.hash=l,k&&(n.hashMirror=t),n}return null}function y(e,r){var o=r.hash,a=0;return!e.zhash[o]&&((!k||(a=r.hashMirror,!e.zhash[a]))&&(e.zhash[o]=!0,k&&(e.zhash[a]=!0),e.states.push(r),!0))}this.solve=function(e,r){r&&r.hasOwnProperty("useMirror")&&"boolean"==typeof r.useMirror&&(k=r.useMirror);var o=a(e);return o&&function(e){for(var r,o,a=0;a<e.states.length;){var l=e.states[a++];if(u(e,l),r=e,void 0,3===(o=l.blocks[r.caoIdx]).row&&1===o.col)return s(e,l),!0;b(e,l)}return!1}(o)?o.result.moves:null}}"undefined"!=typeof define&&null!==define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&null!==module&&"undefined"!=typeof exports&&module.exports===exports?module.exports=e:"undefined"!=typeof self&&"function"==typeof self.postMessage&&"function"==typeof self.importScripts?self.Klotski=e:"undefined"!=typeof window&&null!==window&&(window.Klotski=e)}();